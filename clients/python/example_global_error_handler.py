"""
κΈ€λ΅λ² μ—λ¬ ν•Έλ“¤λ¬ μ‚¬μ© μμ 

enable_global_error_handler μµμ…μ„ ν™μ„±ν™”ν•λ©΄
λ¨λ“  uncaught exceptionsκ°€ μλ™μΌλ΅ λ΅κΉ…λ©λ‹λ‹¤.
"""

import time
from log_collector import AsyncLogClient

# ============================================================================
# λ°©λ²• 1: μƒμ„±μ νλΌλ―Έν„°λ΅ ν™μ„±ν™”
# ============================================================================
logger = AsyncLogClient(
    "http://localhost:8000",
    service="my-python-app",
    environment="production",
    enable_global_error_handler=True  # κΈ€λ΅λ² μ—λ¬ ν•Έλ“¤λ¬ ν™μ„±ν™”
)

print("β… κΈ€λ΅λ² μ—λ¬ ν•Έλ“¤λ¬κ°€ ν™μ„±ν™”λμ—μµλ‹λ‹¤.")
print("μ΄μ  λ¨λ“  μ—λ¬κ°€ μλ™μΌλ΅ λ΅κΉ…λ©λ‹λ‹¤!\n")

# ============================================================================
# ν…μ¤νΈ 1: μΌλ° λ΅κΉ… (μ—¬μ „ν μ‘λ™)
# ============================================================================
logger.info("Application started", version="1.0.0")
logger.warn("This is a warning", custom_field="test")

# ============================================================================
# ν…μ¤νΈ 2: Uncaught Exception (μλ™ λ΅κΉ…)
# ============================================================================
print("\nπ“ ν…μ¤νΈ 2: Uncaught Exception")
print("3μ΄ ν›„ μ—λ¬λ¥Ό λ°μƒμ‹ν‚µλ‹λ‹¤...")
time.sleep(3)

# μ΄ μ—λ¬λ” μλ™μΌλ΅ λ΅κΉ…λ©λ‹λ‹¤ (try-except μ—†μ΄λ„!)
raise ValueError("This is an uncaught exception!")

# ============================================================================
# λ°©λ²• 2: ν™κ²½ λ³€μλ΅ ν™μ„±ν™”
# ============================================================================
# .env νμΌμ— μ¶”κ°€:
#   ENABLE_GLOBAL_ERROR_HANDLER=true
#
# κ·Έλ¬λ©΄ λ…μ‹μ μΌλ΅ νλΌλ―Έν„°λ¥Ό μ „λ‹¬ν•μ§€ μ•μ•„λ„ μλ™μΌλ΅ ν™μ„±ν™”λ©λ‹λ‹¤:
#   logger = AsyncLogClient(
#       "http://localhost:8000",
#       service="my-app"
#   )

# ============================================================================
# μ£Όμμ‚¬ν•­
# ============================================================================
# 1. enable_global_error_handlerλ” κΈ°λ³Έκ°’μ΄ Falseμ…λ‹λ‹¤
# 2. sys.excepthookμ„ μ‚¬μ©ν•λ―€λ΅ λ‹¤λ¥Έ μ—λ¬ ν•Έλ“¤λ¬μ™€ μ¶©λν•  μ μμµλ‹λ‹¤
# 3. ν”„λ΅λ•μ… ν™κ²½μ—μ„λ” μ‹ μ¤‘ν•κ² μ‚¬μ©ν•μ„Έμ”
# 4. close() νΈμ¶ μ‹ μλ™μΌλ΅ ν•Έλ“¤λ¬κ°€ ν•΄μ λ©λ‹λ‹¤

# ============================================================================
# λ°μ΄ν„°λ² μ΄μ¤μ—μ„ ν™•μΈν•κΈ°
# ============================================================================
# SELECT created_at, level, message, metadata, stack_trace
# FROM logs
# WHERE service = 'my-python-app'
#   AND level = 'ERROR'
# ORDER BY created_at DESC;
